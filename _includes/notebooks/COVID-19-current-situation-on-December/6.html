<div class="container" id="notebook-container"><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[6]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">confirmed_global_melt_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">deaths_global_melt_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">recovered_global_melt_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">,</span> <span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[7]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython3"><pre><span></span><span class="c1"># --- US ---</span>
<span class="n">confirmed_us_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;time_series_covid19_confirmed_US.csv&#39;</span><span class="p">)</span>
<span class="n">deaths_us_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;time_series_covid19_deaths_US.csv&#39;</span><span class="p">)</span>

<span class="c1"># 丟掉不須用到的欄位</span>
<span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;UID&#39;</span><span class="p">,</span> <span class="s1">&#39;iso2&#39;</span><span class="p">,</span> <span class="s1">&#39;iso3&#39;</span><span class="p">,</span> <span class="s1">&#39;code3&#39;</span><span class="p">,</span> <span class="s1">&#39;FIPS&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin2&#39;</span><span class="p">,</span> <span class="s1">&#39;Combined_Key&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">deaths_us_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;UID&#39;</span><span class="p">,</span> <span class="s1">&#39;iso2&#39;</span><span class="p">,</span> <span class="s1">&#39;iso3&#39;</span><span class="p">,</span> <span class="s1">&#39;code3&#39;</span><span class="p">,</span> <span class="s1">&#39;FIPS&#39;</span><span class="p">,</span> <span class="s1">&#39;Admin2&#39;</span><span class="p">,</span> <span class="s1">&#39;Combined_Key&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 將 Long_ 欄位改名為 Long</span>
<span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Long_&#39;</span><span class="p">:</span> <span class="s1">&#39;Long&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">deaths_us_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Long_&#39;</span><span class="p">:</span> <span class="s1">&#39;Long&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 變更日期的格式，由 mm/dd/yy 改成 yy-mm-dd</span>
<span class="n">_convert_date_str</span><span class="p">(</span><span class="n">confirmed_us_df</span><span class="p">)</span>
<span class="n">_convert_date_str</span><span class="p">(</span><span class="n">deaths_us_df</span><span class="p">)</span>

<span class="c1"># clean</span>
<span class="c1"># 丟掉不屬於美國的地區</span>
<span class="n">confirmed_us_df</span> <span class="o">=</span> <span class="n">confirmed_us_df</span><span class="p">[</span><span class="o">~</span><span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">Province_State</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Diamond Princess|Grand Princess|Recovered|Northern Mariana Islands|American Samoa&quot;</span><span class="p">)]</span>
<span class="n">deaths_us_df</span> <span class="o">=</span> <span class="n">deaths_us_df</span><span class="p">[</span><span class="o">~</span><span class="n">deaths_us_df</span><span class="o">.</span><span class="n">Province_State</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Diamond Princess|Grand Princess|Recovered|Northern Mariana Islands|American Samoa&quot;</span><span class="p">)]</span>

<span class="c1"># --- Aggregate by province state ---</span>
<span class="c1">#confirmed_us_df.groupby([&#39;Country_Region&#39;, &#39;Province_State&#39;])</span>
<span class="n">confirmed_us_df</span> <span class="o">=</span> <span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">deaths_us_df</span> <span class="o">=</span> <span class="n">deaths_us_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># remove lat, long.</span>
<span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">deaths_us_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 合併日期</span>
<span class="n">confirmed_us_melt_df</span> <span class="o">=</span> <span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">confirmed_us_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;ConfirmedCases&#39;</span><span class="p">)</span>
<span class="n">deaths_us_melt_df</span> <span class="o">=</span> <span class="n">deaths_us_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">deaths_us_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Deaths&#39;</span><span class="p">)</span>

<span class="c1"># 將美國確診及死亡的資料合併</span>
<span class="n">train_us</span> <span class="o">=</span> <span class="n">confirmed_us_melt_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">deaths_us_melt_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[8]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython3"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">train_us</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">train_us</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">:</span> <span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">:</span> <span class="s1">&#39;province&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;ConfirmedCases&#39;</span><span class="p">:</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Deaths&#39;</span><span class="p">:</span> <span class="s1">&#39;fatalities&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_us</span><span class="p">[</span><span class="s1">&#39;country_province&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_us</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">train_us</span><span class="p">[</span><span class="s1">&#39;province&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[9]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython3"><pre><span></span><span class="n">train</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[9]:</div><div class="output_html rendered_html output_subarea output_execute_result"><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Country_Region</th><th>Province_State</th><th>Lat</th><th>Long</th><th>Date</th><th>ConfirmedCases</th><th>Deaths</th><th>Recovered</th></tr></thead><tbody><tr><th>0</th><td>Afghanistan</td><td>NaN</td><td>33.0000</td><td>65.0000</td><td>2020-01-22</td><td>0</td><td>0</td><td>0.0</td></tr><tr><th>1</th><td>Albania</td><td>NaN</td><td>41.1533</td><td>20.1683</td><td>2020-01-22</td><td>0</td><td>0</td><td>0.0</td></tr><tr><th>2</th><td>Algeria</td><td>NaN</td><td>28.0339</td><td>1.6596</td><td>2020-01-22</td><td>0</td><td>0</td><td>0.0</td></tr><tr><th>3</th><td>Andorra</td><td>NaN</td><td>42.5063</td><td>1.5218</td><td>2020-01-22</td><td>0</td><td>0</td><td>0.0</td></tr><tr><th>4</th><td>Angola</td><td>NaN</td><td>-11.2027</td><td>17.8739</td><td>2020-01-22</td><td>0</td><td>0</td><td>0.0</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>7825</th><td>US</td><td>Virginia</td><td>NaN</td><td>NaN</td><td>2020-06-14</td><td>54506</td><td>1546</td><td>NaN</td></tr><tr><th>7826</th><td>US</td><td>Washington</td><td>NaN</td><td>NaN</td><td>2020-06-14</td><td>25834</td><td>1217</td><td>NaN</td></tr><tr><th>7827</th><td>US</td><td>West Virginia</td><td>NaN</td><td>NaN</td><td>2020-06-14</td><td>2290</td><td>88</td><td>NaN</td></tr><tr><th>7828</th><td>US</td><td>Wisconsin</td><td>NaN</td><td>NaN</td><td>2020-06-14</td><td>22758</td><td>692</td><td>NaN</td></tr><tr><th>7829</th><td>US</td><td>Wyoming</td><td>NaN</td><td>NaN</td><td>2020-06-14</td><td>1060</td><td>18</td><td>NaN</td></tr></tbody></table><p>45965 rows × 8 columns</p></div></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[10]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Country_Region&#39;</span><span class="p">:</span> <span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;Province_State&#39;</span><span class="p">:</span> <span class="s1">&#39;province&#39;</span><span class="p">,</span> <span class="s1">&#39;Id&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;ConfirmedCases&#39;</span><span class="p">:</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Deaths&#39;</span><span class="p">:</span> <span class="s1">&#39;fatalities&#39;</span><span class="p">,</span> <span class="s1">&#39;Recovered&#39;</span><span class="p">:</span> <span class="s1">&#39;recovered&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train</span><span class="p">[</span><span class="s1">&#39;country_province&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;province&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># test.rename({&#39;Country_Region&#39;: &#39;country&#39;, &#39;Province_State&#39;: &#39;province&#39;, &#39;Id&#39;: &#39;id&#39;, &#39;Date&#39;: &#39;date&#39;, &#39;ConfirmedCases&#39;: &#39;confirmed&#39;, &#39;Fatalities&#39;: &#39;fatalities&#39;}, axis=1, inplace=True)</span>
<span class="c1"># test[&#39;country_province&#39;] = test[&#39;country&#39;].fillna(&#39;&#39;) + &#39;/&#39; + test[&#39;province&#39;].fillna(&#39;&#39;)</span>
</pre></div></div></div></div></div></div>